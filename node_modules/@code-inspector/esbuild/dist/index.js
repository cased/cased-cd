"use strict";var f=(n,u,l)=>new Promise((o,i)=>{var p=t=>{try{a(l.next(t))}catch(s){i(s)}},e=t=>{try{a(l.throw(t))}catch(s){i(s)}},a=t=>t.done?o(t.value):Promise.resolve(t.value).then(p,e);a((l=l.apply(n,u)).next())});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("@code-inspector/core"),h=require("fs"),y=require("path"),C="@code-inspector/esbuild";function T(n){return{name:C,setup(u){if(n.close||!r.isDev(n.dev,!1))return;const l={port:0,entry:"",output:n.output},{escapeTags:o=[]}=n,i=new Map;u.onLoad({filter:n.match||/\.(jsx|tsx|js|ts|mjs|mts)?$/},p=>f(this,null,function*(){let e=p.path;e=r.getMappingFilePath(e,n.mappings);let a=yield h.promises.readFile(e,"utf8"),t=i.get(e);if(!t||t.originCode!==a){let s=a;if(r.isExcludedFile(e,n))return s;s=yield r.getCodeWithWebComponent({options:n,file:e,code:s,record:l});let c="";if(r.isJsTypeFile(e)?c="jsx":e.endsWith(".svelte")&&(c="svelte"),c)s=r.transformCode({content:s,filePath:e,fileType:c,escapeTags:o,pathType:n.pathType});else if(e.endsWith(".vue")){c="vue";const{descriptor:d}=r.parseSFC(s,{sourceMap:!1}),g=r.transformCode({content:d.template.content,filePath:e,fileType:c,escapeTags:o,pathType:n.pathType});s=s.replace(d.template.content,g)}const m=y.extname(e).replace(".","");t={originCode:a,output:{contents:s,loader:m}},i.set(e,t)}return t.output}))}}}exports.EsbuildCodeInspectorPlugin=T;
